@model IEnumerable<WebArsip.Mvc.Models.ViewModels.DocumentViewModel>

@{
    ViewData["Title"] = "📄 Document List";
}

<link rel="stylesheet" href="~/css/document/index.css" />
<link rel="stylesheet" href="~/css/_responsive.css" />
<link rel="stylesheet" href="~/css/theme/datatables-theme.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<div class="container mt-5 mb-5 document-container fade-in">
    <div class="card glass-card shadow-lg border-0 p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-semibold text-gradient">
                <i class="bi bi-files"></i> Document Management
            </h3>
            @if (ViewBag.CanUpload == true)
            {
                <a href="@Url.Action("BulkCreate")" class="btn btn-secondary mb-3">
                    Bulk Upload
                </a>
            }
            <a asp-action="Create" class="btn btn-primary btn-glass px-4 rounded-pill">
                <i class="bi bi-plus-circle"></i> Add New Document
            </a>

            <a asp-action="BulkCreate" class="btn btn-primary btn-glass px-4 rounded-pill">
                <i class="bi bi-plus-circle"></i> Bulk Upload
            </a>
        </div>

        <div class="table-responsive">
            <table id="documentTable" class="table table-dark table-hover align-middle mb-0">
                <thead class="glass-header">
                    <tr>
                        <th>No</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Created By</th>
                        <th>Created At</th>
                        <th>Status</th>
                        <th>Version</th>
                        <th class="text-center" style="width: 260px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var doc in Model)
                        {
                            <tr>
                                <td></td>
                                <td>@doc.Title</td>
                                <td>@doc.Description</td>
                                <td>@doc.CreatedBy</td>
                                <td>@doc.CreatedDate.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>
                                    <span class="badge bg-@(doc.Status == "Published" ? "success" : "warning") px-3 py-2">
                                        @doc.Status
                                    </span>
                                </td>
                                <td>v@(doc.Version)</td>
                                <td class="text-center">

                                    <!-- 🌙 Mobile (Dropdown) -->
                                    <div class="dropdown d-block d-sm-none">
                                        <button class="btn btn-dark btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                            Actions
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-dark">
                                            <li>
                                                <a class="dropdown-item btn-preview"
                                                   href="#"
                                                   data-id="@doc.DocId"
                                                   data-filepath="@doc.FilePath"
                                                   data-name="@doc.Title">
                                                    Preview
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item"
                                                   asp-action="Edit"
                                                   asp-route-id="@doc.DocId">
                                                    Edit
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item btn-download"
                                                   href="#"
                                                   data-id="@doc.DocId"
                                                   data-name="@doc.Title">
                                                    Download
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item delete-btn"
                                                   href="#"
                                                   data-id="@doc.DocId"
                                                   data-title="@doc.Title">
                                                    Delete
                                                </a>
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- 💻 Desktop Buttons -->
                                    <div class="d-none d-sm-flex gap-2 justify-content-center">
                                        <button class="btn btn-info btn-sm btn-preview"
                                                data-id="@doc.DocId"
                                                data-filepath="@doc.FilePath"
                                                data-name="@doc.Title"
                                                title="Preview">
                                            <i class="bi bi-eye"></i>
                                        </button>

                                        <a asp-action="Edit" asp-route-id="@doc.DocId"
                                           class="btn btn-warning btn-sm text-white"
                                           title="Edit">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>

                                        <button class="btn btn-secondary btn-sm btn-download"
                                                data-id="@doc.DocId"
                                                data-name="@doc.Title"
                                                title="Download">
                                            <i class="bi bi-download"></i>
                                        </button>

                                        <button class="btn btn-danger btn-sm delete-btn"
                                                data-id="@doc.DocId"
                                                data-title="@doc.Title"
                                                title="Delete">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>

                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr><td colspan="7" class="text-center text-muted">No documents found.</td></tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content glass-card text-light fade-in">
            <div class="modal-header border-0">
                <h5 class="modal-title text-gradient"><i class="bi bi-eye"></i> Document Preview</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0" style="height: 85vh;">
                <iframe id="previewFrame" src="" width="100%" height="100%" frameborder="0"></iframe>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/js/document/index.js"></script>
    <script src="~/js/theme/datatables-theme.js"></script>


    @if (TempData["Success"] != null)
    {
        <text>
            <script>
                Swal.fire({ toast: true, icon: 'success', title: '@TempData["Success"]', position: 'top-end', showConfirmButton: false, timer: 2000 });
            </script>
        </text>
    }
    @if (TempData["Error"] != null)
    {
        <text>
            <script>
                Swal.fire({ toast: true, icon: 'error', title: '@TempData["Error"]', position: 'top-end', showConfirmButton: false, timer: 2000 });
            </script>
        </text>
    }
}